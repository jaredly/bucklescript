
    
<!doctype html>
<meta charset=utf8>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel=stylesheet href='../styles.css'>
<script defer src='../script.js'></script>
<title>Buckle_meetup</title>
<body>
<script>window.relativeToRoot=".."</script>
<script defer src="../block-script.js"></script>
<div id='error-message'>
  ⚠️ Oops! This page doesn't appear to define a <span>type</span> called <code>_</code>.
</div>

    
    <div class='container'>
    
    <div class='sidebar-wrapper'>
    <div class='sidebar-expander'>Show navigation</div>
    <div class='sidebar'>
      <a href="../search.html" style="display: block; padding: 0 8px;">Search</a>
      <a href="../playground.html" style="display: block; padding: 0 8px;">Playground</a>
      <div class='docs-listing'><a href="../docson/index.html">docson</a>
<a href="../fonts/LICENSE.html">LICENSE</a>
<a href="../index.html">docs</a>
<a href="./Buckle_meetup.html">Buckle_meetup</a>
<a href="./Haskell_meetup.html">Haskell_meetup</a>
<a href="./preview/CONTRIBUTING.html">CONTRIBUTING</a>
<a href="./preview/reveal-js/css/theme/index.html">theme</a>
<a href="./preview/reveal-js/plugin/markdown/example.html">example</a>
<a href="./preview/reveal-js/REVEAL_JS.html">REVEAL_JS</a>
<a href="./preview/Slides/bb-reveal-example/overview.html">overview</a></div>
      <div class='toc-header'>Page Contents</div>
      <div class='table-of-contents'>
      <a href="#ocaml--lt-3-javascript" class='level-1 header'>OCaml &lt;3 Javascript</a>
<a href="#why-ocaml" class='level-1 header'>Why OCaml</a>
<a href="#why-js" class='level-1 header'>Why JS</a>
<a href="#benefits-of-bucklescript" class='level-1 header'>Benefits of BuckleScript</a>
<a href="#what-bucklescript-looks-like" class='level-1 header'>What BuckleScript looks like</a>
<a href="#comparison-with-hand-written-js" class='level-1 header'>Comparison with hand-written JS</a>
<a href="#bucklescript--javascript-typescript-interaction" class='level-1 header'>BuckleScript, Javascript/Typescript interaction</a>
<a href="#bucklescript-function-ffi" class='level-1 header'>BuckleScript Function FFI</a>
<a href="#bucklescript-object-ffi---i" class='level-1 header'>BuckleScript Object FFI - I</a>
<a href="#bucklescript-object-ffi---ii" class='level-1 header'>BuckleScript Object FFI - II</a>
<a href="#bucklescript-object-ffi---ii" class='level-1 header'>BuckleScript Object FFI - II</a>
<a href="#how-can-it-be-possible---what--39-s-the-magic--" class='level-1 header'>How can it be possible? (What&#39;s the magic?)</a>
<a href="#internals-of-bucklescript---an-optimizing-js-backend-for-ocaml" class='level-1 header'>Internals of BuckleScript - an optimizing JS backend for OCaml</a>
<a href="#the-ocaml-compiler-workflow" class='level-1 header'>The OCaml compiler workflow</a>
<a href="#comparison-with--typescript" class='level-1 header'>Comparison with  Typescript</a>
<a href="#comparison-with--js_of_ocaml" class='level-1 header'><a href="https://bucklescript.github.io/bucklescript/Differences-from-js_of_ocaml.html" target="_blank" rel="noopener nofollow" title="" class="external-link">Comparison with  Js_of_ocaml</a></a>
<a href="#demo" class='level-1 header'>Demo</a>
<a href="#future-work" class='level-1 header'>Future work</a>
      </div>
      <div class='project-title'>Package modules</div><div class='project-listing'><a href="../api/Js.html">Js</a>
<a href="../api/Arg.html">Arg</a>
<a href="../api/Array.html">Array</a>
<a href="../api/ArrayLabels.html">ArrayLabels</a>
<a href="../api/Bigarray.html">Bigarray</a>
<a href="../api/Buffer.html">Buffer</a>
<a href="../api/Bytes.html">Bytes</a>
<a href="../api/BytesLabels.html">BytesLabels</a>
<a href="../api/Callback.html">Callback</a>
<a href="../api/CamlinternalFormat.html">CamlinternalFormat</a>
<a href="../api/CamlinternalFormatBasics.html">CamlinternalFormatBasics</a>
<a href="../api/CamlinternalLazy.html">CamlinternalLazy</a>
<a href="../api/CamlinternalMod.html">CamlinternalMod</a>
<a href="../api/CamlinternalOO.html">CamlinternalOO</a>
<a href="../api/Char.html">Char</a>
<a href="../api/Complex.html">Complex</a>
<a href="../api/Digest.html">Digest</a>
<a href="../api/Filename.html">Filename</a>
<a href="../api/Format.html">Format</a>
<a href="../api/Gc.html">Gc</a>
<a href="../api/Genlex.html">Genlex</a>
<a href="../api/Hashtbl.html">Hashtbl</a>
<a href="../api/Int32.html">Int32</a>
<a href="../api/Int64.html">Int64</a>
<a href="../api/Lazy.html">Lazy</a>
<a href="../api/Lexing.html">Lexing</a>
<a href="../api/List.html">List</a>
<a href="../api/ListLabels.html">ListLabels</a>
<a href="../api/Map.html">Map</a>
<a href="../api/Marshal.html">Marshal</a>
<a href="../api/MoreLabels.html">MoreLabels</a>
<a href="../api/Nativeint.html">Nativeint</a>
<a href="../api/Obj.html">Obj</a>
<a href="../api/Oo.html">Oo</a>
<a href="../api/Parsing.html">Parsing</a>
<a href="../api/Pervasives.html">Pervasives</a>
<a href="../api/Printexc.html">Printexc</a>
<a href="../api/Printf.html">Printf</a>
<a href="../api/Queue.html">Queue</a>
<a href="../api/Random.html">Random</a>
<a href="../api/Scanf.html">Scanf</a>
<a href="../api/Set.html">Set</a>
<a href="../api/Sort.html">Sort</a>
<a href="../api/Stack.html">Stack</a>
<a href="../api/Std_exit.html">Std_exit</a>
<a href="../api/StdLabels.html">StdLabels</a>
<a href="../api/Stream.html">Stream</a>
<a href="../api/String.html">String</a>
<a href="../api/StringLabels.html">StringLabels</a>
<a href="../api/Sys.html">Sys</a>
<a href="../api/Unix.html">Unix</a>
<a href="../api/UnixLabels.html">UnixLabels</a>
<a href="../api/Weak.html">Weak</a>
<a href="../api/Belt.html">Belt</a>
<a href="../api/Belt_Array.html">Belt_Array</a>
<a href="../api/Belt_HashMap.html">Belt_HashMap</a>
<a href="../api/Belt_HashMapInt.html">Belt_HashMapInt</a>
<a href="../api/Belt_HashMapString.html">Belt_HashMapString</a>
<a href="../api/Belt_HashSet.html">Belt_HashSet</a>
<a href="../api/Belt_HashSetInt.html">Belt_HashSetInt</a>
<a href="../api/Belt_HashSetString.html">Belt_HashSetString</a>
<a href="../api/Belt_Id.html">Belt_Id</a>
<a href="../api/Belt_internalAVLset.html">Belt_internalAVLset</a>
<a href="../api/Belt_internalAVLtree.html">Belt_internalAVLtree</a>
<a href="../api/Belt_internalBuckets.html">Belt_internalBuckets</a>
<a href="../api/Belt_internalBucketsType.html">Belt_internalBucketsType</a>
<a href="../api/Belt_internalMapInt.html">Belt_internalMapInt</a>
<a href="../api/Belt_internalMapString.html">Belt_internalMapString</a>
<a href="../api/Belt_internalSetBuckets.html">Belt_internalSetBuckets</a>
<a href="../api/Belt_internalSetInt.html">Belt_internalSetInt</a>
<a href="../api/Belt_internalSetString.html">Belt_internalSetString</a>
<a href="../api/Belt_List.html">Belt_List</a>
<a href="../api/Belt_Map.html">Belt_Map</a>
<a href="../api/Belt_MapDict.html">Belt_MapDict</a>
<a href="../api/Belt_MapInt.html">Belt_MapInt</a>
<a href="../api/Belt_MapString.html">Belt_MapString</a>
<a href="../api/Belt_MutableMap.html">Belt_MutableMap</a>
<a href="../api/Belt_MutableMapInt.html">Belt_MutableMapInt</a>
<a href="../api/Belt_MutableMapString.html">Belt_MutableMapString</a>
<a href="../api/Belt_MutableQueue.html">Belt_MutableQueue</a>
<a href="../api/Belt_MutableSet.html">Belt_MutableSet</a>
<a href="../api/Belt_MutableSetInt.html">Belt_MutableSetInt</a>
<a href="../api/Belt_MutableSetString.html">Belt_MutableSetString</a>
<a href="../api/Belt_MutableStack.html">Belt_MutableStack</a>
<a href="../api/Belt_Option.html">Belt_Option</a>
<a href="../api/Belt_Range.html">Belt_Range</a>
<a href="../api/Belt_Set.html">Belt_Set</a>
<a href="../api/Belt_SetDict.html">Belt_SetDict</a>
<a href="../api/Belt_SetInt.html">Belt_SetInt</a>
<a href="../api/Belt_SetString.html">Belt_SetString</a>
<a href="../api/Belt_SortArray.html">Belt_SortArray</a>
<a href="../api/Belt_SortArrayInt.html">Belt_SortArrayInt</a>
<a href="../api/Belt_SortArrayString.html">Belt_SortArrayString</a>
<a href="../api/Dom.html">Dom</a>
<a href="../api/Dom_storage.html">Dom_storage</a>
<a href="../api/Js_array.html">Js_array</a>
<a href="../api/Js_boolean.html">Js_boolean</a>
<a href="../api/Js_cast.html">Js_cast</a>
<a href="../api/Js_console.html">Js_console</a>
<a href="../api/Js_date.html">Js_date</a>
<a href="../api/Js_dict.html">Js_dict</a>
<a href="../api/Js_global.html">Js_global</a>
<a href="../api/Js_json.html">Js_json</a>
<a href="../api/Js_list.html">Js_list</a>
<a href="../api/Js_mapperRt.html">Js_mapperRt</a>
<a href="../api/Js_math.html">Js_math</a>
<a href="../api/Js_null_undefined.html">Js_null_undefined</a>
<a href="../api/Js_obj.html">Js_obj</a>
<a href="../api/Js_option.html">Js_option</a>
<a href="../api/Js_promise.html">Js_promise</a>
<a href="../api/Js_re.html">Js_re</a>
<a href="../api/Js_result.html">Js_result</a>
<a href="../api/Js_string.html">Js_string</a>
<a href="../api/Js_types.html">Js_types</a>
<a href="../api/Js_vector.html">Js_vector</a>
<a href="../api/Node.html">Node</a>
<a href="../api/Node_buffer.html">Node_buffer</a>
<a href="../api/Node_child_process.html">Node_child_process</a>
<a href="../api/Node_fs.html">Node_fs</a>
<a href="../api/Node_module.html">Node_module</a>
<a href="../api/Node_path.html">Node_path</a>
<a href="../api/Node_process.html">Node_process</a></div>
    </div>
    </div>
  
    <div class='main'>
    <a href="https://github.com/bucklescript/bucklescript/blob/master/docs/slides/Buckle_meetup.md" class="edit-link">Edit</a>
    <p>class: center, middle</p>
<a href="#ocaml--lt-3-javascript" id="ocaml--lt-3-javascript"><h1>OCaml &lt;3 Javascript</h1></a>

<p><img style='width: 550px;' alt='Drawing' title='OCamlscript' src='images/Slide3.PNG' /></p>
<p>Hongbo Zhang@Bloomberg</p>
<p>May 19, 2016</p>
<p><hr/></p>
<a href="#why-ocaml" id="why-ocaml"><h1>Why OCaml</h1></a>

<ul><li>You are here probably you already know <a href="https://realworldocaml.org/v1/en/html/prologue.html" target="_blank" rel="noopener nofollow" title="" class="external-link">the great parts of OCaml</a></li></ul>

<a href="#why-js" id="why-js"><h1>Why JS</h1></a>

<ul><li><p>JS is the only language of the browser</p>
</li><li><p>JS is everywhere (Electron for Desktop App, NodeJS on server
 side, huge potential on <a href="https://blogs.windows.com/buildingapps/2015/05/12/bringing-node-js-to-windows-10-iot-core/" target="_blank" rel="noopener nofollow" title="" class="external-link">IoT</a>)</p>
</li><li><p>JS is where people are (npm: <a href="http://www.modulecounts.com/" target="_blank" rel="noopener nofollow" title="" class="external-link">largest package manager 2 years ago</a>)</p>
</li></ul>

<p><hr/></p>
<a href="#benefits-of-bucklescript" id="benefits-of-bucklescript"><h1>Benefits of BuckleScript</h1></a>

<ul><li>For JS developers :</li></ul>

<ul><li>Type safety</li><li>Higher (both compile-time and runtime) performance</li><li>Smaller</li></ul>

<ul><li>For OCaml developers (Today&#39;s topic)</li></ul>

<ul><li>Seamless integration with existing JS ecosystem</li></ul>

<p><hr/></p>
<a href="#what-bucklescript-looks-like" id="what-bucklescript-looks-like"><h1>What BuckleScript looks like</h1></a>

<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='25' id='block-25'><code>let <span class='pattern-ident' data-type="unit => 'a">test</span> <span class='pattern-constructor' data-type="unit">()</span> =
  let <span class='pattern-ident' data-type="'a">m</span> = <span class='ident' data-type="'a => Pervasives.ref('a)">ref</span> IntMap.empty in
  let count = 1000000 in
  for i = 0 to count do
    m := IntMap.add i i !m
  done;
  for j = 0 to count  do
    ignore (IntMap.find j !m )
  done;;
test()</code></pre>
  
  <script type='docre-source' data-block-id="25">let test () =
  let m = ref IntMap.empty in
  let count = 1000000 in
  for i = 0 to count do
    m := IntMap.add i i !m
  done;
  for j = 0 to count  do
    ignore (IntMap.find j !m )
  done;;
test()</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 2, characters 14-26:
Error: Unbound module IntMap</div>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='25-alt' id='block-25-alt'><code>let <span class='pattern-ident' data-type="unit => 'a">test</span> = <span class='pattern-constructor' data-type="unit">()</span> =&gt; {
  let <span class='pattern-ident' data-type="'a">m</span> = <span class='ident' data-type="'a => Pervasives.ref('a)">ref</span>(IntMap.empty);
  let count = 1000000;
  for (i in 0 to count) {
    m := IntMap.add(i, i, m^);
  };
  for (j in 0 to count) {
    ignore(IntMap.find(j, m^));
  };
};

test();</code></pre>
  
  <script type='docre-source' data-block-id="25-alt">let test = () => {
  let m = ref(IntMap.empty);
  let count = 1000000;
  for (i in 0 to count) {
    m := IntMap.add(i, i, m^);
  };
  for (j in 0 to count) {
    ignore(IntMap.find(j, m^));
  };
};

test();</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 2, characters 14-26:
Error: Unbound module IntMap</div>
</div>

<pre class='js'><code class='js'>
&quot;use strict&quot;;
var Int_map=require(&quot;./int_map.js&quot;);

function test() {
  var m = /* Empty */0;
  for(var i = 0; i &lt;= 1000000; ++i){
    m = add(i, i, m);
  }
  for(var j = 0; j &lt;= 1000000; ++j){
    find(j, m);
  }
  return /* () */0;
}

test(/* () */0);</code></pre>

<p><hr/></p>
<a href="#comparison-with-hand-written-js" id="comparison-with-hand-written-js"><h1>Comparison with hand-written JS</h1></a>

<pre class='js'><code class='js'>// Immutable map from Facebook immutable library

&#39;use strict&#39;;
var Immutable = require(&#39;immutable&#39;);
var Map = Immutable.Map;
var m = new Map();
function test(){
    var count  = 1000000
    for(var i = 0; i &lt; count; ++i){
        m = m.set(i, i );
    }
    for(var j = 0; j &lt; count ; ++j){
        m.get(j)
    } }
test ()</code></pre>

<p>Runtime performance of identical functionality:</p>
<p>| Technology   |  Time(s) | Code Size  |
|--------------|----------| -----------|
| OCaml with Javascript Backend   |1186ms (Google Closure bundler: simple mode) |   1 KB |
| Handwritten Facebook Javascript  |3415ms |  55.3 KBytes|</p>
<p><hr/></p>
<a href="#bucklescript--javascript-typescript-interaction" id="bucklescript--javascript-typescript-interaction"><h1>BuckleScript, Javascript/Typescript interaction</h1></a>

<ol><li><p>Call BuckleScript from Javascript code (no extra work to do)</p>
</li><li><p>Call BuckleScript from Typescript: BuckleScript emits <code>.d.ts</code> files
 for TypeScript compiler (<em>experimental</em>)</p>
</li><li><p>Call Javascript from BuckleScript (type declarations like TypeScript)</p>
</li></ol>

<p><hr/></p>
<a href="#bucklescript-function-ffi" id="bucklescript-function-ffi"><h1>BuckleScript Function FFI</h1></a>

<pre class='OCaml'><code class='OCaml'>external array_map : &#39;a array -&gt; (&#39;a -&gt; &#39;b [@uncurry]) -&gt; &#39;b array =
  &quot;Array.prototype.map.call&quot; [@@bs.call ]


let v = array_map [|1,2,3|] (fun%uncurry x -&gt; x+ 3 )</code></pre>

<pre class='js'><code class='js'>
var v = Array.prototype.map.call(
          [1,2,3],
          (function(x){return x + 3}))</code></pre>

<p><hr/></p>
<a href="#bucklescript-object-ffi---i" id="bucklescript-object-ffi---i"><h1>BuckleScript Object FFI - I</h1></a>

<pre class='OCaml'><code class='OCaml'>(** [Http_lib.ml] *)
let port = 3000
let hostname = &quot;127.0.0.1&quot;
let create_server  http =
  let server = http##createServer (fun %uncurry  (req,  resp)  -&gt;
      resp##statusCode__set 200; (* setter always ends with [__end] *)
      resp##setHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
      resp##end__ &quot;Hello world\n&quot; (* end is a key word in OCaml *)
    )
  in
  server##listen(port, hostname,  fun %uncurry () -&gt;
      Js.log (&quot;Server running at http://&quot;^ hostname ^ &quot;:&quot; ^ string_of_int port ^ &quot;/&quot;)
    )

</code></pre>

<pre class='js'><code class='js'>var hostname = &quot;127.0.0.1&quot;;

function create_server(http) {
  var server = http.createServer(function (_, resp) {
        resp.statusCode = 200;
        resp.setHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
        return resp.end(&quot;Hello world\n&quot;);
      });
  return server.listen(3000, hostname, function () {
              console.log(&quot;Server running at http://&quot; + (hostname + (&quot;:&quot; + (3000 + &quot;/&quot;))));
              return /* () */0;
            });
}</code></pre><p><hr/></p>
<a href="#bucklescript-object-ffi---ii" id="bucklescript-object-ffi---ii"><h1>BuckleScript Object FFI - II</h1></a>

<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='24' id='block-24'><code>(** Bindings for NodeJS [Http_binding.ml] *)

type req

type resp = <
   statusCode__set : int -> unit [@uncurry] ;
   setHeader : string * string -> unit [@uncurry] ;
   end__ : string ->  unit [@uncurry]
> Js.t

type server =  <
   listen : int * string *  (unit -> unit [@uncurry]) -> unit [@uncurry];
> Js.t



type http = <
   createServer : (req  * resp  -> unit [@uncurry] ) ->  server [@uncurry]
> Js.t


external http : http  = "http"  [@@bs.val_of_module ]

</code></pre>
  <div class='code-post'>unable to process, .cmt missing</div>
  <script type='docre-source' data-block-id="24">(** Bindings for NodeJS [Http_binding.ml] *)

type req

type resp = <
   statusCode__set : int -> unit [@uncurry] ;
   setHeader : string * string -> unit [@uncurry] ;
   end__ : string ->  unit [@uncurry]
> Js.t

type server =  <
   listen : int * string *  (unit -> unit [@uncurry]) -> unit [@uncurry];
> Js.t



type http = <
   createServer : (req  * resp  -> unit [@uncurry] ) ->  server [@uncurry]
> Js.t


external http : http  = "http"  [@@bs.val_of_module ]

</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 22, characters 0-53:
Error: Could not infer which FFI category it belongs to, maybe you forgot [@@bs.val]? </div>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='24-alt' id='block-24-alt'><code>/** Bindings for NodeJS [Http_binding.ml] */;

type req;

type resp = {
  .
  [@uncurry] "statusCode__set": int => unit,
  [@uncurry] "setHeader": ((string, string)) => unit,
  [@uncurry] "end__": string => unit,
};

type server = {
  .
  [@uncurry] "listen": ((int, string, [@uncurry] (unit => unit))) => unit,
};

type http = {
  .
  [@uncurry] "createServer": ([@uncurry] (((req, resp)) => unit)) => server,
};

[@bs.val_of_module] external http : http = "http";</code></pre>
  <div class='code-post'>unable to process, .cmt missing</div>
  <script type='docre-source' data-block-id="24-alt">/** Bindings for NodeJS [Http_binding.ml] */;

type req;

type resp = {
  .
  [@uncurry] "statusCode__set": int => unit,
  [@uncurry] "setHeader": ((string, string)) => unit,
  [@uncurry] "end__": string => unit,
};

type server = {
  .
  [@uncurry] "listen": ((int, string, [@uncurry] (unit => unit))) => unit,
};

type http = {
  .
  [@uncurry] "createServer": ([@uncurry] (((req, resp)) => unit)) => server,
};

[@bs.val_of_module] external http : http = "http";</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 22, characters 0-49:
Error: Could not infer which FFI category it belongs to, maybe you forgot [@@bs.val]? </div>
</div>

<p><em>Pure types, no Code generated</em>, like <em>tsd</em>, but it is just plain
 OCaml program.</p>
<p><hr/></p>
<a href="#bucklescript-object-ffi---ii" id="bucklescript-object-ffi---ii"><h1>BuckleScript Object FFI - II</h1></a>

<pre class='OCaml'><code class='OCaml'>(** [Http_start.ml]*)

let () =
  Http_lib.create_server Http_binding.http</code></pre>

<pre class='js'><code class='js'>var Http_lib = require(&#39;./http_lib&#39;);
var http = require(&#39;http&#39;);
Http_lib.create_server(http);</code></pre>

<p><hr/></p>
<a href="#how-can-it-be-possible---what--39-s-the-magic--" id="how-can-it-be-possible---what--39-s-the-magic--"><h1>How can it be possible? (What&#39;s the magic?)</h1></a>

<ol><li>OCaml is like a <em>formal</em> Javascript</li></ol>

<p> Both OCaml and Javascript have similar concepts which make compiling OCaml to Javascript posible:</p>
<div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='23' id='block-23'><code><span class='ident' data-type="bool => bool">!</span>[](OCaml_Javascript_features.png)</code></pre>
  
  <script type='docre-source' data-block-id="23">![](OCaml_Javascript_features.png)</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 1, characters 1-3:
Error: This variant expression is expected to have type bool
       The constructor [] does not belong to type bool</div>
</div><div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='23-alt' id='block-23-alt'><code>[@@@ocaml.ppx.context { cookies = [] }]
let _ = <span class='ident' data-type="bool => bool">not</span> (([])[@explicit_arity ])</code></pre>
  
  <script type='docre-source' data-block-id="23-alt">[@@@ocaml.ppx.context { cookies = [] }]
let _ = not (([])[@explicit_arity ])</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 2, characters 14-16:
Error: This variant expression is expected to have type bool
       The constructor [] does not belong to type bool</div>
</div><ol><li>OCaml has a similar <strong>module system</strong> to Javascript 2015, it supports both Javascript like structural typing
 and ML style type inference.</li><li>ML is used in some of the foundational work of Javascript:<ul><li>ES4 (abandoned standard) reference implementation</li><li>The first prototype of Facebook&#39;s ReactJS implementation</li><li>Official reference implementation of WebAssembly</li></ul></li></ol>

<p><hr/></p>
<a href="#internals-of-bucklescript---an-optimizing-js-backend-for-ocaml" id="internals-of-bucklescript---an-optimizing-js-backend-for-ocaml"><h1>Internals of BuckleScript - an optimizing JS backend for OCaml</h1></a>

<p>Leverage the (high-level, strongly typed) OCaml language tool-chain to generate optimized JS</p>
<ul><li>Dev mode:<ul><li><em>No name mangling</em>, easy to debug</li><li>Separate and <strong>blazing fast</strong> compilation</li><li>Easy integration with existing JS libraries</li><li>Dead code elimination and Purity analysis</li><li>Local and cross module optimization</li></ul></li><li>Production mode:<ul><li>Link time optimization (combination with Google Closure Compiler)</li><li>Remove unused functions further in the library level</li></ul></li><li>Result:<ul><li><strong>Faster, Smaller, and Safer!</strong></li></ul></li></ul>

<p><hr/></p>
<a href="#the-ocaml-compiler-workflow" id="the-ocaml-compiler-workflow"><h1>The OCaml compiler workflow</h1></a>

<div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='22' id='block-22'><code> Source code
        |
        | parsing and preprocessing
        |
        v
    Parsetree (untyped AST)
        |
        | type inference and checking
        v
    Typedtree (type-annotated AST)
        |
        | pattern-matching compilation
        | elimination of modules and classes
        v
     Lambda ------------------------(our work)----------+
      /   \                                              \
     /     \ closure conversion, inlining, uncurrying,    \
    v       \  data representation strategy                \
 Bytecode    \                                              |
    |         +-----+                                       |
    |              Cmm                                      IR
    |ocamlrun       |                                       |
    |               | code generation                       | code generation
    |               | assembly &amp; linking                    |
    v               v                                       v
 Interpreted    Compiled                                 Javacript(and meta data for optimizations)</code></pre>
  
  
  
</div><div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='22-alt' id='block-22-alt'><code>Unable to refmt code with a syntax error</code></pre>
  
  
  
</div>

<p><hr/></p>
<a href="#comparison-with--typescript" id="comparison-with--typescript"><h1>Comparison with  Typescript</h1></a>

<ul><li><p>Readable output code, great editor</p>
</li><li><p>Compile time slow</p>
</li></ul>

<p> A micro benchmark:</p>
<p> Two files: one file define 500 fib functions,
 one file call those 500 fib functions</p>
<div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='21' id='block-21'><code>             BS: 0m0.063s
             TS: 0m1.427s
   </code></pre>
  
  
  
</div><div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='21-alt' id='block-21-alt'><code>Unable to refmt code with a syntax error</code></pre>
  
  
  
</div><p> BuckleScript will be even faster in the future with flambda enabled.</p>
<ul><li>Unsound type system, limited type inference (all arguments have to be annotated)</li><li>Only Javascript backend</li><li>No code optimizations</li></ul>

<a href="#comparison-with--js_of_ocaml" id="comparison-with--js_of_ocaml"><h1><a href="https://bucklescript.github.io/bucklescript/Differences-from-js_of_ocaml.html" target="_blank" rel="noopener nofollow" title="" class="external-link">Comparison with  Js_of_ocaml</a></h1></a>

<p><hr/></p>
<a href="#demo" id="demo"><h1>Demo</h1></a>

<ul><li><a href="https://github.com/bobzhang/bucklescript-demo" target="_blank" rel="noopener nofollow" title="" class="external-link">Code Repo</a></li></ul>

<p><hr/></p>
<a href="#future-work" id="future-work"><h1>Future work</h1></a>

<ul><li><p>More tests (currently around 1400 tests)</p>
</li><li><p>Bindings to existing JS library (using typescript compiler API)</p>
</li><li><p>Toolings and help get people started</p>
</li><li><p>Catching up with the latest compiler (currently work with 4.02.3)</p>
</li><li><p>Optimizations</p>
</li><li><p>Our own bundler for purely OCaml part</p>
</li></ul>
    </div>
    <div class='right-blank'></div>
    </div>
  