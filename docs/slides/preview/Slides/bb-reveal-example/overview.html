
    
<!doctype html>
<meta charset=utf8>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel=stylesheet href='../../../../styles.css'>
<script defer src='../../../../script.js'></script>
<title>overview</title>
<body>
<script>window.relativeToRoot="../../../.."</script>
<script defer src="../../../../block-script.js"></script>
<div id='error-message'>
  ⚠️ Oops! This page doesn't appear to define a <span>type</span> called <code>_</code>.
</div>

    
    <div class='container'>
    
    <div class='sidebar-wrapper'>
    <div class='sidebar-expander'>Show navigation</div>
    <div class='sidebar'>
      <a href="../../../../search.html" style="display: block; padding: 0 8px;">Search</a>
      <a href="../../../../playground.html" style="display: block; padding: 0 8px;">Playground</a>
      <div class='docs-listing'><a href="../../../../docson/index.html">docson</a>
<a href="../../../Haskell_meetup.html">Haskell_meetup</a>
<a href="../../../Buckle_meetup.html">Buckle_meetup</a>
<a href="./overview.html">overview</a>
<a href="../../CONTRIBUTING.html">CONTRIBUTING</a>
<a href="../../reveal-js/css/theme/index.html">theme</a>
<a href="../../reveal-js/REVEAL_JS.html">REVEAL_JS</a>
<a href="../../reveal-js/plugin/markdown/example.html">example</a>
<a href="../../../../index.html">docs</a>
<a href="../../../../fonts/LICENSE.html">LICENSE</a></div>
      <div class='toc-header'>Page Contents</div>
      <div class='table-of-contents'>
      <a href="#bucklescript" class='level-1 header'>BuckleScript</a>
<a href="#why-bucklescript-" class='level-2 header'>Why BuckleScript?</a>
<a href="#why-ocaml" class='level-3 header'>Why OCaml</a>
<a href="#why-js" class='level-3 header'>Why JS</a>
<a href="#current-status" class='level-2 header'>Current status</a>
<a href="#design-goals--differences-from-js_of_ocaml-" class='level-2 header'>Design goals (differences from Js_of_ocaml)</a>
<a href="#a-brief-overview-of-compiler-pipeline" class='level-2 header'>A brief overview of compiler pipeline</a>
<a href="#what-does-it-look-like-" class='level-2 header'>What does it look like?</a>
<a href="#balanced-tree-with-2-million-keys-insertion-and-deletion" class='level-2 header'>Balanced tree with 2 million keys insertion and deletion</a>
<a href="#a-brief-look-at-ffi--call-ocaml-from-js-" class='level-2 header'>A brief look at FFI (Call OCaml from JS)</a>
<a href="#ffi----calling-javascript-from-ocaml-" class='level-2 header'>FFI:  (Calling Javascript from OCaml)</a>
<a href="#ffi-examples" class='level-2 header'>FFI examples</a>
<a href="#ffi-examples" class='level-2 header'>FFI examples</a>
<a href="#ffi-examples--http-server-using-node.js-" class='level-2 header'>FFI examples (http server using Node.js)</a>
<a href="#ffi-examples--ffi-bindings-to-nodejs-http-module-" class='level-2 header'>FFI examples (FFI bindings to NODEJS http module)</a>
<a href="#ffi--http-server-" class='level-3 header'>FFI (HTTP server)</a>
<a href="#easy-to-set-up" class='level-2 header'>Easy to set up</a>
<a href="#different-semantics--from-other-back-ends" class='level-2 header'>Different Semantics  from other back-ends</a>
<a href="#data-representation" class='level-2 header'>Data representation</a>
<a href="#wishes-from-ocaml-compiler-upstream" class='level-2 header'>Wishes from OCaml compiler upstream</a>
<a href="#wishes-from-ocaml-compiler-upstream" class='level-2 header'>Wishes from OCaml compiler upstream</a>
<a href="#wishes-from-ocaml-compiler-upstream" class='level-2 header'>Wishes from OCaml compiler upstream</a>
<a href="#wishes-from-ocaml-compiler-upstream" class='level-2 header'>Wishes from OCaml compiler upstream</a>
<a href="#questions" class='level-2 header'>Questions</a>
      </div>
      <div class='project-title'>Package modules</div><div class='project-listing'><a href="../../../../api/Js.html">Js</a>
<a href="../../../../api/Marshal.html">Marshal</a>
<a href="../../../../api/ListLabels.html">ListLabels</a>
<a href="../../../../api/Buffer.html">Buffer</a>
<a href="../../../../api/MoreLabels.html">MoreLabels</a>
<a href="../../../../api/Set.html">Set</a>
<a href="../../../../api/Nativeint.html">Nativeint</a>
<a href="../../../../api/Complex.html">Complex</a>
<a href="../../../../api/Genlex.html">Genlex</a>
<a href="../../../../api/UnixLabels.html">UnixLabels</a>
<a href="../../../../api/Filename.html">Filename</a>
<a href="../../../../api/Printf.html">Printf</a>
<a href="../../../../api/Stack.html">Stack</a>
<a href="../../../../api/Sys.html">Sys</a>
<a href="../../../../api/CamlinternalFormatBasics.html">CamlinternalFormatBasics</a>
<a href="../../../../api/Obj.html">Obj</a>
<a href="../../../../api/Std_exit.html">Std_exit</a>
<a href="../../../../api/Random.html">Random</a>
<a href="../../../../api/Stream.html">Stream</a>
<a href="../../../../api/Callback.html">Callback</a>
<a href="../../../../api/Lazy.html">Lazy</a>
<a href="../../../../api/CamlinternalOO.html">CamlinternalOO</a>
<a href="../../../../api/Gc.html">Gc</a>
<a href="../../../../api/Array.html">Array</a>
<a href="../../../../api/Char.html">Char</a>
<a href="../../../../api/Lexing.html">Lexing</a>
<a href="../../../../api/Printexc.html">Printexc</a>
<a href="../../../../api/Int32.html">Int32</a>
<a href="../../../../api/CamlinternalLazy.html">CamlinternalLazy</a>
<a href="../../../../api/Pervasives.html">Pervasives</a>
<a href="../../../../api/List.html">List</a>
<a href="../../../../api/Bytes.html">Bytes</a>
<a href="../../../../api/Hashtbl.html">Hashtbl</a>
<a href="../../../../api/CamlinternalFormat.html">CamlinternalFormat</a>
<a href="../../../../api/Queue.html">Queue</a>
<a href="../../../../api/BytesLabels.html">BytesLabels</a>
<a href="../../../../api/Parsing.html">Parsing</a>
<a href="../../../../api/Oo.html">Oo</a>
<a href="../../../../api/CamlinternalMod.html">CamlinternalMod</a>
<a href="../../../../api/String.html">String</a>
<a href="../../../../api/ArrayLabels.html">ArrayLabels</a>
<a href="../../../../api/Int64.html">Int64</a>
<a href="../../../../api/Sort.html">Sort</a>
<a href="../../../../api/StringLabels.html">StringLabels</a>
<a href="../../../../api/Digest.html">Digest</a>
<a href="../../../../api/Bigarray.html">Bigarray</a>
<a href="../../../../api/Arg.html">Arg</a>
<a href="../../../../api/Map.html">Map</a>
<a href="../../../../api/StdLabels.html">StdLabels</a>
<a href="../../../../api/Weak.html">Weak</a>
<a href="../../../../api/Format.html">Format</a>
<a href="../../../../api/Scanf.html">Scanf</a>
<a href="../../../../api/Unix.html">Unix</a>
<a href="../../../../api/Belt_MutableQueue.html">Belt_MutableQueue</a>
<a href="../../../../api/Belt_MapDict.html">Belt_MapDict</a>
<a href="../../../../api/Belt_List.html">Belt_List</a>
<a href="../../../../api/Js_string.html">Js_string</a>
<a href="../../../../api/Js_date.html">Js_date</a>
<a href="../../../../api/Belt_MapString.html">Belt_MapString</a>
<a href="../../../../api/Js_math.html">Js_math</a>
<a href="../../../../api/Belt.html">Belt</a>
<a href="../../../../api/Js_null_undefined.html">Js_null_undefined</a>
<a href="../../../../api/Node_path.html">Node_path</a>
<a href="../../../../api/Belt_MutableMap.html">Belt_MutableMap</a>
<a href="../../../../api/Js_types.html">Js_types</a>
<a href="../../../../api/Js_boolean.html">Js_boolean</a>
<a href="../../../../api/Belt_Map.html">Belt_Map</a>
<a href="../../../../api/Belt_SetString.html">Belt_SetString</a>
<a href="../../../../api/Dom_storage.html">Dom_storage</a>
<a href="../../../../api/Js_console.html">Js_console</a>
<a href="../../../../api/Belt_MapInt.html">Belt_MapInt</a>
<a href="../../../../api/Js_json.html">Js_json</a>
<a href="../../../../api/Dom.html">Dom</a>
<a href="../../../../api/Belt_Option.html">Belt_Option</a>
<a href="../../../../api/Js_mapperRt.html">Js_mapperRt</a>
<a href="../../../../api/Js_list.html">Js_list</a>
<a href="../../../../api/Node_process.html">Node_process</a>
<a href="../../../../api/Belt_internalSetBuckets.html">Belt_internalSetBuckets</a>
<a href="../../../../api/Belt_MutableSetString.html">Belt_MutableSetString</a>
<a href="../../../../api/Belt_internalSetInt.html">Belt_internalSetInt</a>
<a href="../../../../api/Node_module.html">Node_module</a>
<a href="../../../../api/Belt_HashMapInt.html">Belt_HashMapInt</a>
<a href="../../../../api/Js_result.html">Js_result</a>
<a href="../../../../api/Belt_MutableMapInt.html">Belt_MutableMapInt</a>
<a href="../../../../api/Node_buffer.html">Node_buffer</a>
<a href="../../../../api/Belt_Array.html">Belt_Array</a>
<a href="../../../../api/Belt_SetInt.html">Belt_SetInt</a>
<a href="../../../../api/Belt_MutableMapString.html">Belt_MutableMapString</a>
<a href="../../../../api/Node.html">Node</a>
<a href="../../../../api/Belt_internalSetString.html">Belt_internalSetString</a>
<a href="../../../../api/Belt_MutableSetInt.html">Belt_MutableSetInt</a>
<a href="../../../../api/Belt_HashSet.html">Belt_HashSet</a>
<a href="../../../../api/Belt_Range.html">Belt_Range</a>
<a href="../../../../api/Belt_internalBucketsType.html">Belt_internalBucketsType</a>
<a href="../../../../api/Js_array.html">Js_array</a>
<a href="../../../../api/Belt_HashSetInt.html">Belt_HashSetInt</a>
<a href="../../../../api/Belt_SetDict.html">Belt_SetDict</a>
<a href="../../../../api/Belt_HashMap.html">Belt_HashMap</a>
<a href="../../../../api/Js_vector.html">Js_vector</a>
<a href="../../../../api/Js_cast.html">Js_cast</a>
<a href="../../../../api/Belt_MutableStack.html">Belt_MutableStack</a>
<a href="../../../../api/Js_promise.html">Js_promise</a>
<a href="../../../../api/Belt_SortArrayInt.html">Belt_SortArrayInt</a>
<a href="../../../../api/Belt_SortArray.html">Belt_SortArray</a>
<a href="../../../../api/Js_global.html">Js_global</a>
<a href="../../../../api/Js_obj.html">Js_obj</a>
<a href="../../../../api/Belt_SortArrayString.html">Belt_SortArrayString</a>
<a href="../../../../api/Belt_Set.html">Belt_Set</a>
<a href="../../../../api/Belt_Id.html">Belt_Id</a>
<a href="../../../../api/Node_fs.html">Node_fs</a>
<a href="../../../../api/Belt_internalBuckets.html">Belt_internalBuckets</a>
<a href="../../../../api/Belt_internalMapInt.html">Belt_internalMapInt</a>
<a href="../../../../api/Js_re.html">Js_re</a>
<a href="../../../../api/Belt_internalAVLset.html">Belt_internalAVLset</a>
<a href="../../../../api/Belt_MutableSet.html">Belt_MutableSet</a>
<a href="../../../../api/Belt_HashSetString.html">Belt_HashSetString</a>
<a href="../../../../api/Js_option.html">Js_option</a>
<a href="../../../../api/Js_dict.html">Js_dict</a>
<a href="../../../../api/Belt_internalAVLtree.html">Belt_internalAVLtree</a>
<a href="../../../../api/Belt_internalMapString.html">Belt_internalMapString</a>
<a href="../../../../api/Node_child_process.html">Node_child_process</a>
<a href="../../../../api/Belt_HashMapString.html">Belt_HashMapString</a></div>
    </div>
    </div>
  
    <div class='main'>
    <a href="https://github.com/bucklescript/bucklescript/blob/master/docs/slides/preview/Slides/bb-reveal-example/overview.md" class="edit-link">Edit</a>
    

<a href="#bucklescript" id="bucklescript"><h1>BuckleScript</h1></a>

<p>Bringing OCaml to Javascript developers</p>
<p>Hongbo Zhang, Bloomberg</p>
<p>OCaml Meetup in Paris</p>
<p>December 6, 2016</p>
<p>===</p>
<a href="#why-bucklescript-" id="why-bucklescript-"><h2>Why BuckleScript?</h2></a>

<a href="#why-ocaml" id="why-ocaml"><h3>Why OCaml</h3></a>

<ul><li>Save this slide for OCaml audience ^_^</li></ul>

<p><hr/></p>
<a href="#why-js" id="why-js"><h3>Why JS</h3></a>

<ul><li>Arguably the most used programming language</li><li>Everywhere and cross platform (Browser: the only language; Desktop
 App: Electron; Server: NodeJS, huge potential on <a href="https://blogs.windows.com/buildingapps/2015/05/12/bringing-node-js-to-windows-10-iot-core/" target="_blank" rel="noopener nofollow" title="" class="external-link">IoT</a>)</li><li>NPM: largest package manager since 2014</li><li>WebAssembly will make JS platform more attractive, for the first
 time cross platform FFI</li><li>Bloomberg is a big industry user of Javascript</li></ul>

<p>===</p>
<a href="#current-status" id="current-status"><h2>Current status</h2></a>

<ul><li>BuckleScript is still a young project (started late 2015)</li><li>It covers the whole language, except libraries relying on c stubs</li><li>It grows fast (the most starred open source project by Bloomberg),
 already used by external users in production (Collaborations with
 Facebook Reason team)</li></ul>

<p><blockquote style= &#39;background: #f9f9f9; &#39;;&gt;</p>
<div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='8' id='block-8'><code>I&#39;m on the Facebook Reason team, and we&#39;re using BuckleScript to compile OCaml into the best compiler output I&#39;ve ever seen. People didn&#39;t recognize that my React components were generated, not hand-written.</code></pre>
  
  
  
</div><div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='8-alt' id='block-8-alt'><code>Unable to refmt code with a syntax error</code></pre>
  
  
  
</div><p>&lt;/blockquote&gt;</p>
<p>===</p>
<a href="#design-goals--differences-from-js_of_ocaml-" id="design-goals--differences-from-js_of_ocaml-"><h2>Design goals (differences from Js_of_ocaml)</h2></a>

<p>Highlights of BuckleScript:</p>
<ul><li>Easy FFI (OCaml -&gt; JS, JS -&gt; OCaml), incremental migration from JS
 to OCaml (One OCaml module &lt;-&gt; One JS module)</li><li>Human debuggable output (not relying on source-map)</li><li>Fast build (Save -&gt; Compile -&gt; Run:  100ms)</li><li>Native Windows support (same build experience)</li></ul>

<p>Advantages of Js_of_ocaml:</p>
<ul><li>No changes to your existing OCaml build system</li><li>Less maintenance effort</li></ul>

<p>===</p>
<a href="#a-brief-overview-of-compiler-pipeline" id="a-brief-overview-of-compiler-pipeline"><h2>A brief overview of compiler pipeline</h2></a>

<p><a href="http://bucklescript.github.io/bucklescript/Manual.html#_high_level_compiler_workflow" target="_blank" rel="noopener nofollow" title="" class="external-link">Compiler pipelines</a></p>
<p>===</p>
<a href="#what-does-it-look-like-" id="what-does-it-look-like-"><h2>What does it look like?</h2></a>

<p><a href="http://bucklescript.github.io/bucklescript-playground/#Balanced_tree" target="_blank" rel="noopener nofollow" title="" class="external-link">Example:  balanced tree</a></p>
<p><hr/></p>
<a href="#balanced-tree-with-2-million-keys-insertion-and-deletion" id="balanced-tree-with-2-million-keys-insertion-and-deletion"><h2>Balanced tree with 2 million keys insertion and deletion</h2></a>

<p>Execution Time (node v7.2.0, BuckleScript + Google Closure, jsoo minify):</p>
<ul><li>OCAMLOPT (-g): 0.837s</li><li>BuckleScript: 2.219s</li><li>JSOO: 3.035s</li><li>OCAMLC (-g): 6.545s</li><li>Using Facebook ImmutableJS lib: 13.520s</li></ul>

<p>JS output size:</p>
<ul><li>BuckleScript: 542 bytes</li><li>JSOO: 3836 bytes</li></ul>

<p>===</p>
<a href="#a-brief-look-at-ffi--call-ocaml-from-js-" id="a-brief-look-at-ffi--call-ocaml-from-js-"><h2>A brief look at FFI (Call OCaml from JS)</h2></a>

<ul><li><code>.mli</code> is respected</li><li>Basic data types are closely matched (Array -&gt; Array, Tuple -&gt; Array, etc)</li><li>BuckleScript can also emit <code>.d.ts</code> files for TypeScript compiler (<em>experimental</em>)</li><li><a href="https://www.npmjs.com/package/bs-platform" target="_blank" rel="noopener nofollow" title="" class="external-link">Publish and consume npm packages out of box</a></li><li><a href="http://bucklescript.github.io/bucklescript-playground/#Use_OCaml_Standard_Library" target="_blank" rel="noopener nofollow" title="" class="external-link">Call OCaml library from JS side</a></li></ul>

<p>===</p>
<a href="#ffi----calling-javascript-from-ocaml-" id="ffi----calling-javascript-from-ocaml-"><h2>FFI:  (Calling Javascript from OCaml)</h2></a>

<p>Users must write <em>type declarations</em> for existing
JavaScript libraries</p>
<ul><li>Introducing built-in extension points and attributes</li><li>Structural typing (model JavaScript Objects)</li><li>Polymorphic variants (model Event handler)</li><li>Label and optional arguments (model JSON configuration)</li></ul>

<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='24' id='block-24'><code>external exp : <span class='type-constructor'>float</span> -&gt; <span class='type-constructor'>float</span> = &quot;Math.exp&quot; [@@bs.val]
let <span class='pattern-ident' data-type="float">v</span> = <span class='ident' data-type="float => float">exp</span> <span class='float' data-type="float">3.</span></code></pre>
  
  <script type='docre-source' data-block-id="24">external exp : float -> float = "Math.exp" [@@bs.val]
let v = exp 3.</script>
  <div data-block-id='24' data-context="normal" data-block-syntax="ml" class='block-target'></div><script type='docre-bundle' data-block-id='24'>
;(function() { // generated by pack.re
let modules = {}
let initializers = {
    1: function(module, exports, require) {// Generated by BUCKLESCRIPT VERSION 3.0.0, PLEASE EDIT WITH CARE
'use strict';


var v = Math.exp(3);

exports.v = v;
/* v Not a pure module */
//# sourceURL=./node_modules/.docre/Bucklescript__Haskell_meetup_md_CODE_BLOCK_24.re_ppx.js
}
};
let nameMap = {
  "./node_modules/.docre/Bucklescript__Haskell_meetup_md_CODE_BLOCK_24.re_ppx.js": 1
}
let require = (id) => {
  if (!modules[id]) {
    modules[id] = {exports: {}}
    initializers[id](modules[id], modules[id].exports, require)
  }
  return modules[id].exports
};
  require(1)})();</script>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='24-alt' id='block-24-alt'><code>[@bs.val] external exp : <span class='type-constructor'>float</span> =&gt; <span class='type-constructor'>float</span> = &quot;Math.exp&quot;;

let <span class='pattern-ident' data-type="float">v</span> = <span class='ident' data-type="float => float">exp</span>(<span class='float' data-type="float">3.</span>);</code></pre>
  
  <script type='docre-source' data-block-id="24-alt">[@bs.val] external exp : float => float = "Math.exp";

let v = exp(3.);</script>
  <div data-block-id='24-alt' data-context="normal" data-block-syntax="re" class='block-target'></div><script type='docre-bundle' data-block-id='24-alt'>
;(function() { // generated by pack.re
let modules = {}
let initializers = {
    1: function(module, exports, require) {// Generated by BUCKLESCRIPT VERSION 3.0.0, PLEASE EDIT WITH CARE
'use strict';


var v = Math.exp(3);

exports.v = v;
/* v Not a pure module */
//# sourceURL=./node_modules/.docre/Bucklescript__Haskell_meetup_md_CODE_BLOCK_24_alt.re_ppx.js
}
};
let nameMap = {
  "./node_modules/.docre/Bucklescript__Haskell_meetup_md_CODE_BLOCK_24_alt.re_ppx.js": 1
}
let require = (id) => {
  if (!modules[id]) {
    modules[id] = {exports: {}}
    initializers[id](modules[id], modules[id].exports, require)
  }
  return modules[id].exports
};
  require(1)})();</script>
</div>

<pre class='js'><code class='js'>var v = Math.exp(3.)</code></pre>

<p><hr/></p>
<a href="#ffi-examples" id="ffi-examples"><h2>FFI examples</h2></a>

<p>Typescript binding:</p>
<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='6' id='block-6'><code>type readline
type line_callback = <span class='type-constructor'><span class='type-constructor'>string</span> -&gt; <span class='type-constructor'>unit</span></span> [@bs]
(*  [bs] annotation to mark it as uncurried callback  *)
type close_callback = <span class='type-constructor'>unit -&gt; <span class='type-constructor'>unit</span></span> [@bs]
external on : <span class='type-constructor'>readline</span> -&gt;
   ([ `line of <span class='type-constructor'>line_callback</span>
    | `close of <span class='type-constructor'>close_callback</span>]
     [@bs.string]) -&gt;  <span class='type-constructor'>unit</span> = &quot;&quot; [@@bs.send]

let <span class='pattern-ident' data-type="readline => 'a">register</span> <span class='pattern-ident' data-type="readline">readline</span> =
  <span class='ident' data-type="(
  readline,
  [ `close of close_callback | `line of line_callback ]
) => unit">on</span> <span class='ident' data-type="readline">readline</span> (`line begin fun s -&gt; prerr_endline s end);
  on readline (`close begin fun () -&gt; prerr_endline &quot;finished&quot; end);
  print_endline &quot;done&quot;</code></pre>
  
  <script type='docre-source' data-block-id="6">type readline
type line_callback = string -> unit [@bs]
(*  [bs] annotation to mark it as uncurried callback  *)
type close_callback = unit -> unit [@bs]
external on : readline ->
   ([ `line of line_callback
    | `close of close_callback]
     [@bs.string]) ->  unit = "" [@@bs.send]

let register readline =
  on readline (`line begin fun s -> prerr_endline s end);
  on readline (`close begin fun () -> prerr_endline "finished" end);
  print_endline "done"</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 11, characters 21-55:
Error: This expression should not be a function, the expected type is
line_callback</div>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='6-alt' id='block-6-alt'><code>type readline;

type line_callback = <span class='type-constructor'>(. <span class='type-constructor'>string</span>) =&gt; <span class='type-constructor'>unit</span></span>;

/*  [bs] annotation to mark it as uncurried callback  */
type close_callback = <span class='type-constructor'>(. unit) =&gt; <span class='type-constructor'>unit</span></span>;

[@bs.send]
external on :
  (
    <span class='type-constructor'>readline</span>,
    [@bs.string] [ | `line(<span class='type-constructor'>line_callback</span>) | `close(<span class='type-constructor'>close_callback</span>)]
  ) =&gt;
  <span class='type-constructor'>unit</span> =
  &quot;&quot;;

let <span class='pattern-ident' data-type="readline => 'a">register</span> = <span class='pattern-ident' data-type="readline">readline</span> =&gt; {
  <span class='ident' data-type="(
  readline,
  [ `close of close_callback | `line of line_callback ]
) => unit">on</span>(<span class='ident' data-type="readline">readline</span>, `line(s =&gt; prerr_endline(s)));
  on(readline, `close(() =&gt; prerr_endline(&quot;finished&quot;)));
  print_endline(&quot;done&quot;);
};</code></pre>
  
  <script type='docre-source' data-block-id="6-alt">type readline;

type line_callback = (. string) => unit;

/*  [bs] annotation to mark it as uncurried callback  */
type close_callback = (. unit) => unit;

[@bs.send]
external on :
  (
    readline,
    [@bs.string] [ | `line(line_callback) | `close(close_callback)]
  ) =>
  unit =
  "";

let register = readline => {
  on(readline, `line(s => prerr_endline(s)));
  on(readline, `close(() => prerr_endline("finished")));
  print_endline("done");
};</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 18, characters 20-43:
Error: This expression should not be a function, the expected type is
line_callback</div>
</div>

<p><hr/></p>
<a href="#ffi-examples" id="ffi-examples"><h2>FFI examples</h2></a>

<ul><li>In BuckleScript, <code>##</code> is used as method dispatch</li></ul>

<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='5' id='block-5'><code>let f obj = obj##height + obj##width
val f : [%obj: &lt; height : int ; width : int ; .. &gt; ] -&gt; int
let a = f [%obj { height = 3; width = 32}] (* compiles *)
let b = f [%obj {height = 3 ; width  = 32; unused = 3 }] (* compiles *)</code></pre>
  
  <script type='docre-source' data-block-id="5">let f obj = obj##height + obj##width
val f : [%obj: < height : int ; width : int ; .. > ] -> int
let a = f [%obj { height = 3; width = 32}] (* compiles *)
let b = f [%obj {height = 3 ; width  = 32; unused = 3 }] (* compiles *)</script>
  <div class='parse-error'>Parse Error:
File &quot;&quot;, line 2, characters 0-3:
Error: Syntax error</div>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='5-alt' id='block-5-alt'><code>Unable to refmt code with a syntax error</code></pre>
  
  
  
</div>

<p><hr/></p>
<a href="#ffi-examples--http-server-using-node.js-" id="ffi-examples--http-server-using-node.js-"><h2>FFI examples (http server using Node.js)</h2></a>

<ul><li><code>Test_http_server</code></li></ul>

<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='4' id='block-4'><code>let <span class='pattern-ident' data-type="int">port</span> = <span class='int' data-type="int">3000</span>
let <span class='pattern-ident' data-type="string">hostname</span> = <span class='string' data-type="string">&quot;127.0.0.1&quot;</span>
let <span class='pattern-ident' data-type="Js.t(
  &lt; createServer : (('e -&gt;
                   &lt; end_ : (string -&gt; 'f [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'f
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
) => 'a">create_server</span> <span class='pattern-ident' data-type="Js.t(
  &lt; createServer : (('e -&gt;
                   &lt; end_ : (string -&gt; 'f [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'f
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
)">http</span>  =
  let <span class='pattern-ident' data-type="Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h [@bs.meth]); .. &gt;
)">server</span> = <span class='ident' data-type="Js.t(
  &lt; createServer : (('e -&gt;
                   &lt; end_ : (string -&gt; 'f [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'f
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
)">http</span><span class='ident' data-type="(
  Js.Internal.meth(
    [ `Arity_1 of
    ('e -&gt;
     &lt; end_ : (string -&gt; 'f [@bs.meth]);
       setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
       statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
     Js.t -&gt; 'f
    [@bs]) ],
    Js.t(
      &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h [@bs.meth]); .. &gt;
    )
  ),
  Js.Internal.fn(
    [ `Arity_2 of
    'e *
    &lt; end_ : (string -&gt; 'f [@bs.meth]);
      setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
      statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
    Js.t ],
    'a
  )
) => Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h [@bs.meth]); .. &gt;
)"><span class='ident' data-type="Js.t(
  &lt; createServer : (('e -&gt;
                   &lt; end_ : (string -&gt; 'f [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'f
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
) => &lt; createServer : (('e -&gt;
                   &lt; end_ : (string -&gt; 'f [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'f
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;">##</span></span>createServer <span class='ident' data-type="(
  'a,
  Js.t(
    &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
  )
) => 'a => Js.Internal.fn(
  [ `Arity_2 of
    'e *
    &lt; end_ : (string -&gt; 'f [@bs.meth]);
      setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
      statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
    Js.t ],
  'a
)">begin fun [@bs] <span class='pattern-ident' data-type="'a">req</span>  <span class='pattern-ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span>  -&gt;
      <span class='type-constructor'><span class='ident' data-type="(Js.Internal.meth([ `Arity_1 of int ], unit), int) => unit"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
) => &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span>##statusCode #= <span class='int' data-type="int">200</span></span></span></span>;
      <span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span><span class='ident' data-type="(
  Js.Internal.meth([ `Arity_2 of string * string ], 'a),
  string,
  string
) => 'a"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
) => &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;">##</span></span>setHeader <span class='string' data-type="string">&quot;Content-Type&quot;</span> <span class='string' data-type="string">&quot;text/plain&quot;</span>;
      <span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span><span class='ident' data-type="(Js.Internal.meth([ `Arity_1 of string ], 'a), string) => 'a"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
) => &lt; end_ : (string -&gt; 'f [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'g [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;">##</span></span>end_ <span class='string' data-type="string">&quot;Hello world\n&quot;</span>
    end</span>
  in
  <span class='ident' data-type="Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h [@bs.meth]); .. &gt;
)">server</span><span class='ident' data-type="(
  Js.Internal.meth(
    [ `Arity_3 of int * string * (unit -&gt; unit [@bs]) ],
    'a
  ),
  int,
  string,
  Js.Internal.fn([ `Arity_0 ], unit)
) => 'a"><span class='ident' data-type="Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h [@bs.meth]); .. &gt;
) => &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'h [@bs.meth]); .. &gt;">##</span></span>listen <span class='ident' data-type="int">port</span> <span class='ident' data-type="string">hostname</span>  <span class='ident' data-type="unit => unit => Js.Internal.fn([ `Arity_0 ], unit)">begin fun [@bs] <span class='pattern-constructor' data-type="unit">()</span> -&gt;
    <span class='ident' data-type="string => unit">Js.log</span> (<span class='string' data-type="string">&quot;Server running at http://&quot;</span><span class='operator' data-type="(string, string) => string">^</span> <span class='ident' data-type="string">hostname</span> <span class='operator' data-type="(string, string) => string">^</span> <span class='string' data-type="string">&quot;:&quot;</span> <span class='operator' data-type="(string, string) => string">^</span> <span class='ident' data-type="int => string">Pervasives.string_of_int</span> <span class='ident' data-type="int">port</span> <span class='operator' data-type="(string, string) => string">^</span> <span class='string' data-type="string">&quot;/&quot;</span>)
  end</span>

let <span class='pattern-constructor' data-type="unit">()</span> =
  <span class='ident' data-type="Js.t(
  &lt; createServer : (('a -&gt;
                   &lt; end_ : (string -&gt; 'b [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'c [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'b
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'd
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
) => 'a">create_server</span> Http_types.http</code></pre>
  
  <script type='docre-source' data-block-id="4">let port = 3000
let hostname = "127.0.0.1"
let create_server http  =
  let server = http##createServer begin fun [@bs] req  resp  ->
      resp##statusCode #= 200;
      resp##setHeader "Content-Type" "text/plain";
      resp##end_ "Hello world\n"
    end
  in
  server##listen port hostname  begin fun [@bs] () ->
    Js.log ("Server running at http://"^ hostname ^ ":" ^ Pervasives.string_of_int port ^ "/")
  end

let () =
  create_server Http_types.http</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 15, characters 16-31:
Error: Unbound module Http_types</div>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='4-alt' id='block-4-alt'><code>let <span class='pattern-ident' data-type="int">port</span> = <span class='int' data-type="int">3000</span>;

let <span class='pattern-ident' data-type="string">hostname</span> = <span class='string' data-type="string">&quot;127.0.0.1&quot;</span>;

let <span class='pattern-ident' data-type="Js.t(
  &lt; createServer : (('m -&gt;
                   &lt; end_ : (string -&gt; 'n [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'n
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
) => 'a">create_server</span> = <span class='pattern-ident' data-type="Js.t(
  &lt; createServer : (('m -&gt;
                   &lt; end_ : (string -&gt; 'n [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'n
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
)">http</span> =&gt; {
  let <span class='pattern-ident' data-type="Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p [@bs.meth]); .. &gt;
)">server</span> =
    <span class='ident' data-type="Js.t(
  &lt; createServer : (('m -&gt;
                   &lt; end_ : (string -&gt; 'n [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'n
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
)">http</span><span class='ident' data-type="(
  Js.Internal.meth(
    [ `Arity_1 of
    ('m -&gt;
     &lt; end_ : (string -&gt; 'n [@bs.meth]);
       setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
       statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
     Js.t -&gt; 'n
    [@bs]) ],
    Js.t(
      &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p [@bs.meth]); .. &gt;
    )
  ),
  Js.Internal.fn(
    [ `Arity_2 of
    'm *
    &lt; end_ : (string -&gt; 'n [@bs.meth]);
      setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
      statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
    Js.t ],
    'a
  )
) => Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p [@bs.meth]); .. &gt;
)"><span class='ident' data-type="Js.t(
  &lt; createServer : (('m -&gt;
                   &lt; end_ : (string -&gt; 'n [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'n
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
) => &lt; createServer : (('m -&gt;
                   &lt; end_ : (string -&gt; 'n [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'n
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;">##</span></span>createServer(<span class='ident' data-type="(
  'a,
  Js.t(
    &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
  )
) => 'a => Js.Internal.fn(
  [ `Arity_2 of
    'm *
    &lt; end_ : (string -&gt; 'n [@bs.meth]);
      setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
      statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
    Js.t ],
  'a
)">(. <span class='pattern-ident' data-type="'a">req</span>, <span class='pattern-ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span>) =&gt; {
      <span class='type-constructor'><span class='ident' data-type="(Js.Internal.meth([ `Arity_1 of int ], unit), int) => unit"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
) => &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span>##statusCode#=<span class='int' data-type="int">200</span></span></span></span>;
      <span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span><span class='ident' data-type="(
  Js.Internal.meth([ `Arity_2 of string * string ], 'a),
  string,
  string
) => 'a"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
) => &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;">##</span></span>setHeader(<span class='string' data-type="string">&quot;Content-Type&quot;</span>, <span class='string' data-type="string">&quot;text/plain&quot;</span>);
      <span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
)">resp</span><span class='ident' data-type="(Js.Internal.meth([ `Arity_1 of string ], 'a), string) => 'a"><span class='ident' data-type="Js.t(
  &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
) => &lt; end_ : (string -&gt; 'n [@bs.meth]);
  setHeader : (string -&gt; string -&gt; 'o [@bs.meth]);
  statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;">##</span></span>end_(<span class='string' data-type="string">&quot;Hello world\n&quot;</span>);
    }</span>);
  <span class='ident' data-type="Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p [@bs.meth]); .. &gt;
)">server</span><span class='ident' data-type="(
  Js.Internal.meth(
    [ `Arity_3 of int * string * (unit -&gt; unit [@bs]) ],
    'a
  ),
  int,
  string,
  Js.Internal.fn([ `Arity_0 ], unit)
) => 'a"><span class='ident' data-type="Js.t(
  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p [@bs.meth]); .. &gt;
) => &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'p [@bs.meth]); .. &gt;">##</span></span>listen(<span class='ident' data-type="int">port</span>, <span class='ident' data-type="string">hostname</span>, <span class='ident' data-type="unit => unit => Js.Internal.fn([ `Arity_0 ], unit)"><span class='pattern-constructor' data-type="unit">(.)</span> =&gt;
    <span class='ident' data-type="string => unit">Js.log</span>(
      <span class='string' data-type="string">&quot;Server running at http://&quot;</span>
      <span class='operator' data-type="(string, string) => string">++</span> <span class='ident' data-type="string">hostname</span>
      <span class='operator' data-type="(string, string) => string">++</span> <span class='string' data-type="string">&quot;:&quot;</span>
      <span class='operator' data-type="(string, string) => string">++</span> <span class='ident' data-type="int => string">Pervasives.string_of_int</span>(<span class='ident' data-type="int">port</span>)
      <span class='operator' data-type="(string, string) => string">++</span> <span class='string' data-type="string">&quot;/&quot;</span>,
    )</span>
  );
};

let <span class='pattern-constructor' data-type="unit">()</span> = <span class='ident' data-type="Js.t(
  &lt; createServer : (('i -&gt;
                   &lt; end_ : (string -&gt; 'j [@bs.meth]);
                     setHeader : (string -&gt; string -&gt; 'k [@bs.meth]);
                     statusCode#= : (int -&gt; unit [@bs.meth]); .. &gt;
                   Js.t -&gt; 'j
                  [@bs]) -&gt;
                  &lt; listen : (int -&gt; string -&gt; (unit -&gt; unit [@bs]) -&gt; 'l
                             [@bs.meth]);
                    .. &gt;
                  Js.t
                 [@bs.meth]);
  .. &gt;
) => 'a">create_server</span>(Http_types.http);</code></pre>
  
  <script type='docre-source' data-block-id="4-alt">let port = 3000;

let hostname = "127.0.0.1";

let create_server = http => {
  let server =
    http##createServer((. req, resp) => {
      resp##statusCode#=200;
      resp##setHeader("Content-Type", "text/plain");
      resp##end_("Hello world\n");
    });
  server##listen(port, hostname, (.) =>
    Js.log(
      "Server running at http://"
      ++ hostname
      ++ ":"
      ++ Pervasives.string_of_int(port)
      ++ "/",
    )
  );
};

let () = create_server(Http_types.http);</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 23, characters 23-38:
Error: Unbound module Http_types</div>
</div><p><hr/></p>
<a href="#ffi-examples--ffi-bindings-to-nodejs-http-module-" id="ffi-examples--ffi-bindings-to-nodejs-http-module-"><h2>FFI examples (FFI bindings to NODEJS http module)</h2></a>

<ul><li><code>http_types</code></li></ul>

<div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='3' id='block-3'><code>type req
class type _resp = object
  <span class='type-constructor'><span class='type-constructor'>method statusCode : <span class='type-constructor'><span class='type-constructor'>int</span></span> [@@bs.set]</span></span>
  method setHeader : <span class='type-constructor'><span class='type-constructor'>string</span> -&gt; <span class='type-constructor'>string</span> -&gt; <span class='type-constructor'>unit</span></span>
  method end_ : <span class='type-constructor'><span class='type-constructor'>string</span> -&gt; <span class='type-constructor'>unit</span></span>
end [@bs]
class type _server = object
  method listen : <span class='type-constructor'><span class='type-constructor'>int</span> -&gt; <span class='type-constructor'>string</span> -&gt; (<span class='type-constructor'>unit -&gt; <span class='type-constructor'>unit</span></span> [@bs]) -&gt; <span class='type-constructor'>unit</span></span>
end [@bs]
type server = <span class='type-constructor'>_server</span> <span class='type-constructor'>Js.t</span>
class type _http  = object
  method createServer : (req  -&gt;  resp  -&gt; unit [@bs] ) -&gt;  server
end [@bs]
type http = _http Js.t
external http : http  = &quot;&quot;  [@@bs.module]</code></pre>
  
  <script type='docre-source' data-block-id="3">type req
class type _resp = object
  method statusCode : int [@@bs.set]
  method setHeader : string -> string -> unit
  method end_ : string -> unit
end [@bs]
class type _server = object
  method listen : int -> string -> (unit -> unit [@bs]) -> unit
end [@bs]
type server = _server Js.t
class type _http  = object
  method createServer : (req  ->  resp  -> unit [@bs] ) ->  server
end [@bs]
type http = _http Js.t
external http : http  = ""  [@@bs.module]</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 12, characters 34-38:
Error: Unbound type constructor resp
Hint: Did you mean _resp?</div>
</div><div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='3-alt' id='block-3-alt'><code>type req;

class type _resp =
  [@bs]
  {
    [@bs.set]
    pub statusCode: <span class='type-constructor'><span class='type-constructor'>int</span></span>;
    pub setHeader: <span class='type-constructor'>(<span class='type-constructor'>string</span>, <span class='type-constructor'>string</span>) =&gt; <span class='type-constructor'>unit</span></span>;
    pub end_: <span class='type-constructor'><span class='type-constructor'>string</span> =&gt; <span class='type-constructor'>unit</span></span>
  };

class type _server =
  [@bs]
  {
    pub listen: <span class='type-constructor'>(<span class='type-constructor'>int</span>, <span class='type-constructor'>string</span>, <span class='type-constructor'>(. unit) =&gt; <span class='type-constructor'>unit</span></span>) =&gt; <span class='type-constructor'>unit</span></span>
  };

type server = <span class='type-constructor'>Js.t</span>(<span class='type-constructor'>_server</span>);

class type _http =
  [@bs]
  {
    pub createServer: ((. req, resp) =&gt; unit) =&gt; server
  };

type http = Js.t(_http);

[@bs.module] external http : http = &quot;&quot;;</code></pre>
  
  <script type='docre-source' data-block-id="3-alt">type req;

class type _resp =
  [@bs]
  {
    [@bs.set]
    pub statusCode: int;
    pub setHeader: (string, string) => unit;
    pub end_: string => unit
  };

class type _server =
  [@bs]
  {
    pub listen: (int, string, (. unit) => unit) => unit
  };

type server = Js.t(_server);

class type _http =
  [@bs]
  {
    pub createServer: ((. req, resp) => unit) => server
  };

type http = Js.t(_http);

[@bs.module] external http : http = "";</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 23, characters 31-35:
Error: Unbound type constructor resp
Hint: Did you mean _resp?</div>
</div>

<p><hr/></p>
<a href="#ffi--http-server-" id="ffi--http-server-"><h3>FFI (HTTP server)</h3></a>

<ul><li>Output for <code>http.ml</code> is empty (pure type declarations)</li><li><code>Test_http_server</code></li></ul>

<pre class='js'><code class='js'>var Pervasives = require(&quot;bs-platform/lib/js/pervasives&quot;);
var Http       = require(&quot;http&quot;);

var hostname = &quot;127.0.0.1&quot;;

function create_server(http) {
  var server = http.createServer(function (_, resp) {
        resp.statusCode = 200;
        resp.setHeader(&quot;Content-Type&quot;, &quot;text/plain&quot;);
        return resp.end(&quot;Hello world\n&quot;);
      });
  return server.listen(3000, hostname, function () {
              console.log(&quot;Server running at http://&quot; + (hostname + (&quot;:&quot; + (Pervasives.string_of_int(3000) + &quot;/&quot;))));
              return /* () */0;
            });
}

create_server(Http);</code></pre><p>===</p>
<a href="#easy-to-set-up" id="easy-to-set-up"><h2>Easy to set up</h2></a>

<p>Installation</p>
<div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='2' id='block-2'><code>npm install bs-platform</code></pre>
  
  
  
</div><div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='2-alt' id='block-2-alt'><code>Unable to refmt code with a syntax error</code></pre>
  
  
  
</div>

<p>Create a JSON file to describe the build spec:</p>
<pre class='js'><code class='js'>{
    &quot;name&quot;: &quot;test&quot;,
    &quot;sources&quot;: [
        {
            &quot;dir&quot;: &quot;src&quot;
        }
    ]
}

</code></pre>

<p>Build and run</p>
<div class='code-block' data-block-syntax="re">
  
  <pre class='code' data-block-id='1' id='block-1'><code>bsb <span class='operator' data-type="(int, int) => int">-</span>w</code></pre>
  
  <script type='docre-source' data-block-id="1">bsb -w</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 1, characters 0-3:
Error: Unbound value bsb</div>
</div><div class='code-block' data-block-syntax="ml">
  
  <pre class='code' data-block-id='1-alt' id='block-1-alt'><code>[@@@ocaml.ppx.context { cookies = [] }]
let _ = bsb <span class='operator' data-type="(int, int) => int">-</span> w</code></pre>
  
  <script type='docre-source' data-block-id="1-alt">[@@@ocaml.ppx.context { cookies = [] }]
let _ = bsb - w</script>
  <div class='type-error'>Type Error:
File &quot;&quot;, line 2, characters 8-11:
Error: Unbound value bsb</div>
</div>

<p>===</p>
<a href="#different-semantics--from-other-back-ends" id="different-semantics--from-other-back-ends"><h2>Different Semantics  from other back-ends</h2></a>

<p><a href="http://bucklescript.github.io/bucklescript/Manual.html#_semantics_difference_from_other_backends" target="_blank" rel="noopener nofollow" title="" class="external-link">Semantics diverge</a></p>
<p>===</p>
<a href="#data-representation" id="data-representation"><h2>Data representation</h2></a>

<p><a href="http://bucklescript.github.io/bucklescript/Manual.html#_runtime_representation" target="_blank" rel="noopener nofollow" title="" class="external-link">OCaml data representation in JS</a></p>
<p>===</p>
<a href="#wishes-from-ocaml-compiler-upstream" id="wishes-from-ocaml-compiler-upstream"><h2>Wishes from OCaml compiler upstream</h2></a>

<ul><li>Tell the difference between block and array in lambda layer<ul><li>OCaml Array has to be JS array for better FFI</li><li>More efficient data layout, useful for jsoo too</li></ul></li></ul>

<p><hr/></p>
<a href="#wishes-from-ocaml-compiler-upstream" id="wishes-from-ocaml-compiler-upstream"><h2>Wishes from OCaml compiler upstream</h2></a><ul><li>Native uncurried calling convention support<ul><li>Essential for FFI in callbacks</li><li>BuckleScript attributes is leaky in error message, can not be Polymorpphic</li><li>Useful for jsoo too and external C bindings</li><li>Helps improve perf of  native backend partial application</li><li>Built-in uncurying support can be smarter than ppx
 <code>&#39;a -&gt; int</code> === <code>&#39;a -&gt;  int [@bs]</code></li></ul></li></ul>

<p><hr/></p>
<a href="#wishes-from-ocaml-compiler-upstream" id="wishes-from-ocaml-compiler-upstream"><h2>Wishes from OCaml compiler upstream</h2></a>

<ul><li>More flexible lexical convention for method name, structual typing
 is useful but limited by syntax, name mangling is not cool</li></ul>

<pre class='js'><code class='js'>{ &quot;open&quot; : true }
{ &quot;Content-Type&quot; : &quot;text&quot;}</code></pre><p><hr/></p>
<a href="#wishes-from-ocaml-compiler-upstream" id="wishes-from-ocaml-compiler-upstream"><h2>Wishes from OCaml compiler upstream</h2></a>

<ul><li>Polymorpphic variants as string (with immutable string optimization
 coming)<ul><li>Useful in webprogramming, but generated unreadable code</li></ul></li><li>Lift the char range limitation</li></ul>

<p>===</p>
<a href="#questions" id="questions"><h2>Questions</h2></a>

<p>@bobzhang1988</p>

    </div>
    <div class='right-blank'></div>
    </div>
  